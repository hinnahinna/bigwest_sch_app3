<% provide(:title, "管理者用設定") %>
<div class="row">
  <div class="col-md-6">
    <h3>店舗追加</h3>
    <%= bootstrap_form_for @store do |f| %>
      <div class="add-store-field">
        <%= f.label :追加する店舗名を入力してください %><br />
        <%= f.text_field :storename, hide_label: true %>
      </div>
      <%= f.submit "追加", class: "btn btn-primary" %>
    <% end %>
  </div>
  <div class="col-md-6">
    <h3>追加済み店舗一覧</h3>
    <div>
      <table class="table-bordered table-striped table-responsive common-table">
        <tr>
          <th>店舗名</th>
        </tr>
        <% @stores.each do |store| %>
          <tr class="stores">
            <td><%= store.storename%></td>
            <td><%= link_to "削除", store, method: :delete, data: { confirm: "警告：店舗を削除すると、紐付いているシフトも削除されます。\nこの操作は取り消せません。\n削除してもよろしいですか？"}%></td>
          </tr>
        <% end %>
      </table>
    </div>
  </div>
</div>

<br>
<br>
<br>

<div class="row">
  <div class="col-md-6">
    <h3>管理者権限追加</h3>
    <%= search_form_for @users_search, url: users_adminsettings_path do |f| %>

      <%= f.label :id_eq, "ユーザ名"%>
      <%= f.collection_select :id_eq, @users, :id, :username, {include_blank: true} %>
      <br>

      <%= f.label :id_eq, "勤務時間帯"%>
      <%= f.select :duty_hours_eq, [['',nil],['指定なし',0],['朝勤',1],['昼勤',2],['夕勤',3],['夜勤',4],['店長クラス',5]] %>
      <br>

      <%= f.label :admin_eq, "権限"%>
      <%= f.select :admin_eq, [['',nil],['管理者',true],['従業員',false]] %>
      <br>

      <div class="actions ransack-submit"><%= f.submit "検索" %></div>
    <% end %>
  </div>
  <div class="col-md-6">
    <% if @check.present? %>
      <div>
        <table class="table-bordered table-striped table-responsive common-table">
          <tr>
            <th><%= sort_link(@users_search, :username, "ユーザ名") %></th>
            <th><%= sort_link(@users_search, :duty_hours, "勤務時間帯") %></th>
            <th><%= sort_link(@users_search, :admin, "権限") %></th>
          </tr>
          <% @users.each do |user| %>
            <tr class="stores">
              <td><%= user.username   %></td>
              <td>
                <% if user.duty_hours == 0 %>指定なし<% end %>
                <% if user.duty_hours == 1 %>朝勤<% end %>
                <% if user.duty_hours == 2 %>昼勤<% end %>
                <% if user.duty_hours == 3 %>夕勤<% end %>
                <% if user.duty_hours == 4 %>夜勤<% end %>
                <% if user.duty_hours == 5 %>店長クラス<% end %>
              </td>
              <td>
                <% if user.admin? %>
                  管理者
                <% else %>
                  従業員
                <% end %>
              </td>
              <td>
                <% unless user.admin? %>
                  <%= link_to "管理者権限付与", user, method: :patch, data: {confirm: "注意：\n#{user.username}に管理者権限を付与します。"} %>
                <% else %>
                  <%= link_to "管理者権限削除", user, method: :patch, data: {confirm: "注意：\n#{user.username}の管理者権限を削除します。"} %>
                <% end %>
              </td>
              <td>
                <%= link_to "アカウント削除", user, data: { confirm: "警告：この変更は取り消せません\n#{user.username}のアカウントを削除してもよろしいでしょうか？" }, method: :delete, style: "color:red;" %>
              </td>
            </tr>
          <% end %>
        </table>
      </div>
    <% else %>
      <p>
        検索したユーザを表示します。<br>
        未指定は全検索になります。
      </p>
    <% end %>
  </div>
</div>
